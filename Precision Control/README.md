# Integrator

An integrator was created two ways in this lab. The first was was in a passive configuration. The second was in the active configuration. Both circuits were created with a cutoff frequency of 250 Hz to make sure that only the DC component of the waves were kept. Both provided essentially the same data. The only difference was when load was added. When load was added to the passive integrator the output became distorted. This was because another resistor was added into the voltage division. The active integrator didn't have this problem. When load was added to the active integrator there was almost no noticeable change in the output. This is due to the high current sourcing capabilities of the Op amp. Both of the circuits used can be seen below.

![Alt Text]()

The cutoff frequency was played with. When the cutoff was any higher than 250 Hz there was significant distortion in the waveform. When the cutoff frequency was made to be 250 Hz the output wave looked relatively clean. A generated triangle wave using the active low pass filter can bee seen below.

![Alt Text]()

An fft anbalysis was also performed on this circuit to assess the relative frequency magnitudes present in the signal. This result can be seen below.

![Alt Text]()

The result was that most of the frequency content existed in the DC area. After the DC spike there were decreasing magnitude spikes of harmonics. These decreased quickly as frequency increased, no doubt due to the low pass filtering effects of the circuit. The harmonics seemed to disappear, but there were spikes in higher frequency content that seemed unrelated to the actual signal and most likely just due to noise. Overall, there was not much high frequency content existant in this signal.

## Bill of materials

1: 1 X LM324
2: 3 X 0.066uF capacitor
3: 3 X 10k Ohm Resistor

Digikey cart: http://www.digikey.com/short/q348v1

## Software

The software created for this section was simple. A triangle wave was generated by incrementing and decrementing a PWM signals CCR value. This was done by having two modes. Mode 0 was enabled during the incrementing of the signal. Whem the max PWM was reached mode 1 was enabled and it handled decrementing. When the PWM was at its minimum mode 0 kicked back in and the cycle continued. The code was extremely simple.

## R2R DAC

The R2R DAC is another way to take digital information and turn it into an analog signal. The circuit used for this implementation can be seen below. 

![Alt Text]()

Instead of taking in a PWM signal, this circuit takes in 8 independent GPIO signals from the MSP430. A smooth triangle wave was able to be created. This output waveform created can be seen below. 

![Alt Text]()

An FFT analysis was also performed on this waveform, the resulting scope shot seen below. The fft was taken from 0-1000Hz, where any visible harmonics could be seen. There was very little high frequency content generated by this wave. From a comparison of the two ffts, it appears that the R2R DAC provides a signal which has much less harmonic activity. This is intuitive because the input to the R2R ladder is 8 DC signals while the input to the integrator is a square wave. Therefore, even though the integrator is a low-pass filter, there will be more high frequency content in that signal.However, this could potentially be counter balanced by lowering the cutoff frequency of the integrator to a very low frequency such as 10 Hz.

![Alt Text]()

Loading was tested on the R2R ladder. For smaller loads such as 1 Megaohm the output wave was not effected much. However when a load of 100 Ohms was put on the output the waveform was rendered completely useless. This makes sense because the additional 100 Ohms was drawing all of the current away from the created voltage divider. The output with a 100 ohm load can be seen below.

![Alt Text]()

Howver this loading problem was easily solved. When a buffer was put in between the output and the load, loading ceased to have an effect on the output waveform.

One concern for this DAC architecture is the intput impedance of the microcontroller. For the MSP430's the input impedance is negligible when using resitances in the thousands of ohms. However other microcontrollwers might have input impedances that are large enough to require they are accounted for.

## Bill of Materials

1: 1 X LM324
2: 8 X 22k Resistor
3: 8 X 11k resistor

Digikey cart: http://www.digikey.com/short/q34jjz

## Software

The software written for the R2R ladder was very similar to that of the integrator. Two modes were implemented, one for incrementing and one for decrementing. An 8-bit count was used and was AND'd with the output ports that were assigned to the R2R ladder. Therefore when it was incrementing the outputs would increment with it. Likewise for decrementing, therefore changing the output little by little.